"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var wechatShareTitle=void 0,wechatShareDesc=void 0,wechatShareLink=void 0,wechatShareImgurl=void 0,debug=void 0,callback=void 0,apiDomain=void 0;function ajax(params){params=params||{};params.data=params.data||{};var json=params.jsonp?jsonp(params):json(params);function json(params){params.type=(params.type||"GET").toUpperCase();params.data=formatParams(params.data);var xhr=null;if(window.XMLHttpRequest){xhr=new XMLHttpRequest}else{xhr=new ActiveXObjcet("Microsoft.XMLHTTP")}xhr.onreadystatechange=function(){if(xhr.readyState==4){var status=xhr.status;if(status>=200&&status<300){var response="";var type=xhr.getResponseHeader("Content-type");if(type.indexOf("xml")!==-1&&xhr.responseXML){response=xhr.responseXML}else if(type==="application/json"){response=JSON.parse(xhr.responseText)}else{response=xhr.responseText}params.success&&params.success(response)}else{params.error&&params.error(status)}}};if(params.type=="GET"){xhr.open(params.type,params.url+"?"+params.data,true);xhr.send(null)}else{xhr.open(params.type,params.url,true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");xhr.send(params.data)}}function jsonp(params){var callbackName=params.jsonp+random();var head=document.getElementsByTagName("head")[0];params.data["callback"]=callbackName;var data=formatParams(params.data);var script=document.createElement("script");head.appendChild(script);window[callbackName]=function(json){head.removeChild(script);clearTimeout(script.timer);window[callbackName]=null;params.success&&params.success(json)};script.src=params.url+"?"+data;if(params.time){script.timer=setTimeout(function(){window[callbackName]=null;head.removeChild(script);params.error&&params.error({message:"超时"})},time)}}function formatParams(data){var arr=[];for(var name in data){arr.push(encodeURIComponent(name)+"="+encodeURIComponent(data[name]))}arr.push("v="+random());return arr.join("&")}function random(){return Math.floor(Math.random()*1e4+500)}}var WechatShare=function(){function WechatShare(props){var isDebug=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_classCallCheck(this,WechatShare);callback=props.callback;apiDomain=props.apiDomain||location.origin;debug=isDebug;var self=this;var script=document.createElement("script");script.src="//res.wx.qq.com/open/js/jweixin-1.0.0.js";script.onload=function(){self._init(props)}.bind(this);document.body.appendChild(script)}_createClass(WechatShare,[{key:"_init",value:function _init(props){var title=props.title,desc=props.desc,link=props.link,imgUrl=props.imgUrl;wechatShareTitle=title;wechatShareDesc=desc;wechatShareLink=link;wechatShareImgurl=imgUrl;this.signature()}},{key:"signature",value:function signature(){var self=this;ajax({type:"GET",url:apiDomain+"/api/wechat/jsapi/signature",data:{url:window.location.href},jsonp:"wechatShareCallback",success:function success(data){switch(data.status){case"SUCCESS":var configAppId=data.attributes.config.appid;var configTimestamp=data.attributes.config.timestamp;var configNoncestr=data.attributes.config.noncestr;var configSignature=data.attributes.config.signature;self.wechatShare({configAppId:configAppId,configTimestamp:configTimestamp,configNoncestr:configNoncestr,configSignature:configSignature});break;default:}},error:function error(xhr,errorType,_error){console.log(xhr,errorType,_error)}})}},{key:"wechatShare",value:function wechatShare(params){var configAppId=params.configAppId,configTimestamp=params.configTimestamp,configNoncestr=params.configNoncestr,configSignature=params.configSignature;wx.config({debug:debug,appId:configAppId,timestamp:configTimestamp,nonceStr:configNoncestr,signature:configSignature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone"]});wx.ready(function(){wx.onMenuShareTimeline({title:wechatShareTitle,link:wechatShareLink,imgUrl:wechatShareImgurl,success:function success(){window.location.href=wechatShareLink},cancel:function cancel(){window.location.href=wechatShareLink}});wx.onMenuShareAppMessage({title:wechatShareTitle,desc:wechatShareDesc,link:wechatShareLink,imgUrl:wechatShareImgurl,type:"link",dataUrl:"",success:function success(){window.location.href=wechatShareLink},cancel:function cancel(){window.location.href=wechatShareLink}});wx.onMenuShareQQ({title:wechatShareTitle,desc:wechatShareDesc,link:wechatShareLink,imgUrl:wechatShareImgurl,type:"link",dataUrl:"",success:function success(){window.location.href=wechatShareLink},cancel:function cancel(){window.location.href=wechatShareLink}});wx.onMenuShareQZone({title:wechatShareTitle,desc:wechatShareDesc,link:wechatShareLink,imgUrl:wechatShareImgurl,dataUrl:"",success:function success(){window.location.href=wechatShareLink},cancel:function cancel(){window.location.href=wechatShareLink}});!!callback&&callback()})}}]);return WechatShare}();exports.default=WechatShare;